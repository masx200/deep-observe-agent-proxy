{"version":3,"file":"index.min.js","sources":["index.js"],"sourcesContent":["const Setprototype = Set.prototype;\r\nconst Mapprototype = Map.prototype;\r\nfunction isMap(a) {\r\n    return a instanceof Map;\r\n}\r\nfunction isSet(a) {\r\n    return a instanceof Set;\r\n}\r\nfunction isArray(a) {\r\n    return Array.isArray(a);\r\n}\r\nconst Reflect = window.Reflect;\r\nconst { ownKeys, deleteProperty, apply, construct, defineProperty, get, getOwnPropertyDescriptor, getPrototypeOf, has, set, setPrototypeOf } = Reflect;\r\nfunction isobject(a) {\r\n    return typeof a === \"object\" && a !== null;\r\n}\r\nfunction isfunction(a) {\r\n    return typeof a === \"function\";\r\n}\r\nfunction deepobserveaddpath(target, callback, patharray = [], ancestor = target) {\r\n    if (!isfunction(callback)) {\r\n        console.error(callback);\r\n        console.error(\"observe callback invalid !\");\r\n        throw Error();\r\n    }\r\n    if (isfunction(target) || isobject(target)) {\r\n        let fakeobj;\r\n        if (isSet(target)) {\r\n            fakeobj = new Set([...target]);\r\n            set(fakeobj, \"add\", (value) => {\r\n                Setprototype.add.call(target, value);\r\n                callback(ancestor, patharray, undefined, undefined);\r\n                return Setprototype.add.call(fakeobj, value);\r\n            });\r\n            set(fakeobj, \"delete\", (value) => {\r\n                Setprototype.delete.call(target, value);\r\n                callback(ancestor, patharray, undefined, undefined);\r\n                return Setprototype.delete.call(fakeobj, value);\r\n            });\r\n            set(fakeobj, \"clear\", () => {\r\n                Setprototype.clear.call(target);\r\n                callback(ancestor, patharray, undefined, undefined);\r\n                return Setprototype.clear.call(fakeobj);\r\n            });\r\n        }\r\n        else if (isMap(target)) {\r\n            fakeobj = new Map([...target]);\r\n            set(fakeobj, \"clear\", () => {\r\n                Mapprototype.clear.call(target);\r\n                callback(ancestor, patharray, undefined, undefined);\r\n                return Mapprototype.clear.call(fakeobj);\r\n            });\r\n            set(fakeobj, \"set\", (key, value) => {\r\n                Mapprototype.set.call(target, key, value);\r\n                callback(ancestor, patharray, undefined, undefined);\r\n                return Mapprototype.set.call(fakeobj, key, value);\r\n            });\r\n            set(fakeobj, \"delete\", (value) => {\r\n                Mapprototype.delete.call(target, value);\r\n                callback(ancestor, patharray, undefined, undefined);\r\n                return Mapprototype.delete.call(fakeobj, value);\r\n            });\r\n        }\r\n        else if (isArray(target)) {\r\n            fakeobj = [];\r\n        }\r\n        else if (isfunction(target)) {\r\n            fakeobj = (() => { });\r\n        }\r\n        else {\r\n            fakeobj = {};\r\n        }\r\n        if (!isSet(target) && !isMap(target)) {\r\n            setPrototypeOf(fakeobj, null);\r\n        }\r\n        return new Proxy(fakeobj, {\r\n            defineProperty(t, p, a) {\r\n                callback(ancestor, [...patharray, String(p)], has(a, \"value\") ? a.value : isfunction(a.get) ? a.get() : undefined, get(target, p));\r\n                return defineProperty(target, p, a);\r\n            },\r\n            deleteProperty(t, p) {\r\n                callback(ancestor, [...patharray, String(p)], undefined, get(target, p));\r\n                return deleteProperty(target, p);\r\n            },\r\n            ownKeys() {\r\n                return ownKeys(target);\r\n            },\r\n            has(t, p) {\r\n                return has(target, p);\r\n            },\r\n            getPrototypeOf() {\r\n                return getPrototypeOf(target);\r\n            },\r\n            setPrototypeOf(t, v) {\r\n                return setPrototypeOf(target, v);\r\n            },\r\n            construct(t, argumentslist) {\r\n                if (isfunction(target)) {\r\n                    return construct(target, argumentslist);\r\n                }\r\n            },\r\n            apply(t, thisarg, argarray) {\r\n                if (isfunction(target)) {\r\n                    return apply(target, thisarg, argarray);\r\n                }\r\n            },\r\n            getOwnPropertyDescriptor(t, k) {\r\n                var descripter = getOwnPropertyDescriptor(target, k);\r\n                if (isArray(target) && k === \"length\") {\r\n                    return descripter;\r\n                }\r\n                else {\r\n                    if (descripter) {\r\n                        descripter.configurable = true;\r\n                        return descripter;\r\n                    }\r\n                    else {\r\n                        return;\r\n                    }\r\n                }\r\n            },\r\n            set(t, k, v) {\r\n                if (isfunction(callback)) {\r\n                    callback(ancestor, [...patharray, String(k)], v, get(target, k));\r\n                }\r\n                return set(target, k, v);\r\n            },\r\n            get(t, k) {\r\n                var value = get(target, k);\r\n                if (isfunction(value) && (isSet(target) || isMap(target))) {\r\n                    return get(fakeobj, k).bind(fakeobj);\r\n                }\r\n                if (isfunction(value) || isobject(value)) {\r\n                    return deepobserveaddpath(value, callback, [...patharray, String(k)], target);\r\n                }\r\n                else {\r\n                    return value;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        return target;\r\n    }\r\n}\r\nfunction observedeepagent(target, callback) {\r\n    if (!isfunction(callback)) {\r\n        console.error(callback);\r\n        console.error(\"observe callback  invalid function !\");\r\n        throw Error();\r\n    }\r\n    if (!isfunction(Proxy)) {\r\n        console.error(\"Proxy unsupported!\");\r\n        throw Error();\r\n    }\r\n    if (isfunction(target) || isobject(target)) {\r\n        return deepobserveaddpath(target, callback);\r\n    }\r\n    else {\r\n        return target;\r\n    }\r\n}\n\nexport default observedeepagent;\n//# sourceMappingURL=index.js.map\n"],"names":["Setprototype","Set","prototype","Mapprototype","Map","isMap","a","isSet","isArray","Array","Reflect","window","ownKeys","deleteProperty","apply","construct","defineProperty","get","getOwnPropertyDescriptor","getPrototypeOf","has","set","setPrototypeOf","isobject","isfunction","target","callback","Error","Proxy","deepobserveaddpath","patharray","ancestor","fakeobj","value","add","call","undefined","delete","clear","key","t","p","String","v","[object Object]","argumentslist","thisarg","argarray","k","descripter","configurable","bind"],"mappings":"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"}